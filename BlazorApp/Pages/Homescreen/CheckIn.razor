<Card Class="checkin-card">
    <CardBody>
        <div class="checkin-content">
            <div class="checkin-text">
                <h5>Klar til træning?</h5>
                <p class="text-muted mb-0">Check ind og start din session</p>
            </div>
            <Button Color="ButtonColor.Primary" Size="ButtonSize.Large"
                    @onclick="ShowLocationModal">
                Check ind
            </Button>
        </div>
    </CardBody>
</Card>

<Modal @ref="locationModal" Title="Bekræft lokalitet" Size="ModalSize.Regular">
    <BodyTemplate>
        <div class="modal-content-text">
            <Icon Name="IconName.GeoAltFill" Size="IconSize.x4" Color="IconColor.Primary" />
            <p class="mt-3">Er du i nærheden af FitLife centret?</p>
            <small class="text-muted">Vi skal bekræfte din placering for at checke dig ind</small>
        </div>
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Secondary" @onclick="HideLocationModal">
            Annuller
        </Button>
        <Button Color="ButtonColor.Primary" @onclick="ConfirmCheckIn">
            Bekræft
        </Button>
    </FooterTemplate>
</Modal>

<Modal @ref="successModal" Title="Check-in bekræftet!" Size="ModalSize.Regular">
    <BodyTemplate>
        <div class="modal-content-text success-modal">
            <Icon Name="IconName.CheckCircleFill" Size="IconSize.x5" Color="IconColor.Success" />
            <h5 class="mt-3">Du er nu checket ind!</h5>
            <p class="text-muted">Din streak er blevet opdateret</p>
            <div class="streak-badge">
                <Icon Name="IconName.Fire" Color="IconColor.Warning" />
                <span>@Streak.CurrentStreak dages streak</span>
            </div>
        </div>
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Primary" @onclick="HideSuccessModal">
            Luk
        </Button>
    </FooterTemplate>
</Modal>

@code {
    [Parameter]
    public UserStreak Streak { get; set; } = new();

    private Modal locationModal = default!;
    private Modal successModal = default!;

    private async Task ShowLocationModal()
    {
        await locationModal.ShowAsync();
    }

    private async Task HideLocationModal()
    {
        await locationModal.HideAsync();
    }

    private async Task ConfirmCheckIn()
    {
        // Simulate check-in logic (update streak in-memory)
        Streak.CheckedInToday = true;
        Streak.CurrentStreak++;
        Streak.LastCheckIn = DateTime.Now;

        await locationModal.HideAsync();
        await Task.Delay(300); // Small delay for smooth transition
        await successModal.ShowAsync();
    }

    private async Task HideSuccessModal()
    {
        await successModal.HideAsync();
    }
}
