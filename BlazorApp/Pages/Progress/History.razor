<div class="history-container">
    <h5 class="mb-3">Seneste Træninger</h5>

    @if (!UserWorkouts.Any())
    {
        <Alert Color="AlertColor.Info">
            Ingen træningshistorik endnu. Start din første træning!
        </Alert>
    }
    else
    {
        @foreach (var workout in GetRecentWorkouts())
        {
            <Card Class="mb-3">
                <CardBody>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">@GetWorkoutName(workout)</h6>
                            <small class="text-muted">@GetRelativeDate(workout.CompletedAt ?? workout.Date)</small>
                        </div>
                        <div class="text-end">
                            @if (workout.CompletedAt.HasValue)
                            {
                                <Badge Color="BadgeColor.Success">
                                    <Icon Name="IconName.CheckCircle" Size="IconSize.x4" /> Fuldført
                                </Badge>
                            }
                            else
                            {
                                <Badge Color="BadgeColor.Warning">
                                    <Icon Name="IconName.PlayCircle" Size="IconSize.x4" /> I gang
                                </Badge>
                            }
                        </div>
                    </div>
                </CardBody>
            </Card>
        }
    }
</div>

@code {
    [Parameter]
    public List<UserWorkoutDto> UserWorkouts { get; set; } = [];

    [Parameter]
    public Dictionary<Guid, string> WorkoutNames { get; set; } = [];

    private IEnumerable<UserWorkoutDto> GetRecentWorkouts()
    {
        return UserWorkouts
            .OrderByDescending(w => w.CompletedAt ?? w.Date)
            .Take(10);
    }

    private string GetWorkoutName(UserWorkoutDto workout)
    {
        return WorkoutNames.TryGetValue(workout.WorkoutId, out var name)
            ? name
            : "Træning";
    }

    private string GetRelativeDate(DateTime date)
    {
        var today = DateTime.Today;
        var workoutDate = date.Date;

        if (workoutDate == today)
            return "I dag";
        if (workoutDate == today.AddDays(-1))
            return "I går";
        if (workoutDate > today.AddDays(-7))
            return $"{(today - workoutDate).Days} dage siden";

        return workoutDate.ToString("d. MMM yyyy");
    }
}
