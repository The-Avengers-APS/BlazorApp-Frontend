@page "/profile"
@attribute [Authorize]
@inject IAuthService AuthService
@inject NavigationManager Navigation

<div class="profile-container">
    <div class="container py-4">
        <!-- Profile Header -->
        <div class="profile-header mb-4">
            <h2 class="profile-title">Min Profil</h2>
            <p class="profile-subtitle">Velkommen tilbage, @DisplayName</p>
        </div>

        <!-- Profile Card -->
        <div class="profile-card mb-4">
            <div class="profile-card-content">
                <div class="profile-avatar">
                    <Icon Name="IconName.PersonCircle" Size="IconSize.x5" />
                </div>
                <h3 class="profile-name">@DisplayName</h3>
                <p class="profile-email">@UserEmail</p>
                <span class="membership-badge">@MembershipType</span>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid mb-4">
            <div class="stat-card">
                <div class="stat-icon stat-icon-warning">
                    <Icon Name="IconName.Fire" Size="IconSize.x3" />
                </div>
                <h3 class="stat-value">@totalWorkouts</h3>
                <p class="stat-label">Træninger</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-icon-success">
                    <Icon Name="IconName.CalendarCheck" Size="IconSize.x3" />
                </div>
                <h3 class="stat-value">@currentStreak</h3>
                <p class="stat-label">Dage Streak</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-icon-primary">
                    <Icon Name="IconName.ClockHistory" Size="IconSize.x3" />
                </div>
                <h3 class="stat-value">@totalHours</h3>
                <p class="stat-label">Timer Total</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon stat-icon-danger">
                    <Icon Name="IconName.TrophyFill" Size="IconSize.x3" />
                </div>
                <h3 class="stat-value">@achievements</h3>
                <p class="stat-label">Præstationer</p>
            </div>
        </div>

        <!-- Settings Card -->
        <div class="settings-card">
            <h4 class="settings-title">Konto Indstillinger</h4>
            <div class="settings-list">
                <a href="#" class="settings-item">
                    <div class="settings-item-icon">
                        <Icon Name="IconName.PersonFill" />
                    </div>
                    <span class="settings-item-text">Rediger Profil</span>
                    <Icon Name="IconName.ChevronRight" />
                </a>
                <a href="#" class="settings-item">
                    <div class="settings-item-icon">
                        <Icon Name="IconName.Lock" />
                    </div>
                    <span class="settings-item-text">Skift Adgangskode</span>
                    <Icon Name="IconName.ChevronRight" />
                </a>
                <a href="#" class="settings-item">
                    <div class="settings-item-icon">
                        <Icon Name="IconName.Bell" />
                    </div>
                    <span class="settings-item-text">Notifikationer</span>
                    <Icon Name="IconName.ChevronRight" />
                </a>
                <a href="#" class="settings-item">
                    <div class="settings-item-icon">
                        <Icon Name="IconName.CreditCard" />
                    </div>
                    <span class="settings-item-text">Abonnement</span>
                    <Icon Name="IconName.ChevronRight" />
                </a>
            </div>
        </div>

        <!-- Logout Button -->
        <div class="logout-section">
            <button class="btn-logout" @onclick="Logout">
                <Icon Name="IconName.BoxArrowRight" />
                <span>Log ud</span>
            </button>
        </div>
    </div>
</div>

@code {
    private UserDto? _user;
    private string? _userRole;
    private bool _isLoading = true;

    // Stats - will come from StatsService API later
    private int totalWorkouts = 0;
    private int currentStreak = 0;
    private int totalHours = 0;
    private int achievements = 0;

    protected override async Task OnInitializedAsync()
    {
        _user = await AuthService.GetCurrentUserAsync();
        _userRole = await AuthService.GetCurrentRoleAsync();
        _isLoading = false;

        // TODO: Load stats from StatsService API
    }

    private string DisplayName => _user switch
    {
        { GivenName: not null, FamilyName: not null } => $"{_user.GivenName} {_user.FamilyName}",
        { GivenName: not null } => _user.GivenName,
        { Email: not null } => _user.Email,
        _ => "Bruger"
    };

    private string UserEmail => _user?.Email ?? "";

    private string MembershipType => _userRole switch
    {
        "Admin" => "Administrator",
        "Manager" => "Manager",
        "Trainer" => "Træner",
        "Staff" => "Personale",
        "Lead" => "Gratis bruger",
        "Partner" => "Partner",
        _ => "Medlem"
    };

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}